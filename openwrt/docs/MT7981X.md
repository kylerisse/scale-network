# OpenWrt One (mt7981x)

**IMPORTANT: Prepare an empty FAT32 formatted flash drive with a Master Boot Record (MBR) partition table. If there are any other files in the USB drive, or has a GUID Partition Table (GPT), it won't work.**

## Prerequisites:

- Connect the AP using a data USB-C cable to the USB-C console port (on the front of the AP)
- Find what tty interface the console is located, usually `/dev/ttyACM0` or `/dev/ttyUSB0`
- (Use dmesg with sudo to find what tty interface is using)
- Connect to the console using `screen /dev/ttyACM0 115200`
- (Ensure you run `usrmod -a -G dialout $USER` as sudo, logout then reboot)

## Mass device flashing:

See [Massflash](./MASSFLASH.md)

## Firmware upgrade by USB:

- The file MUST be named or the flash update WON'T WORK.
  "openwrt-mediatek-filogic-openwrt_one-squashfs-sysupgrade.itb".
- The NAND/NOR boot switch must be in the 'NAND' position.
- Insert USB stick into the Type-A USB port on the front of the device.
- Press and hold 'RESET' button while powering up device (USB-C or POE).
- Continue holding 'RESET' until amber LED is blinking.
- Wait for the middle 'OK' light to go green (or wait 1 minute).

## Firmware recovery:

If the device fails to boot or has become unresponsive:

- Place the following files on the USB stick:
  openwrt-mediatek-filogic-openwrt_one-snand-preloader.bin"
  openwrt-mediatek-filogic-openwrt_one-factory.ubi"
  (The 2 above files must be named exactly, or recovery won't work!)
- Insert USB stick on the front of device.
- Flip the "NAND/NOR" boot switch to the 'NOR' position.
- Press and hold the front button while powering up device (USB-C or POE).
- Wait for the middle 'OK' light to go green (or wait 1 minute).

## SCaLE version check

Login using the serial (baud `115200`) terminal and use `cat /proc/scale-version` to verify the correct version used.

## Pull LLDP

Use `lldpcli show nei`

```
System name: name of switch plugged
Port ID: what port is connected to the switch
Port description:
(cf-conference center)
(ex-expo floor)
(infraSLOW & infraFAST)
If it displays any other info - may connected to PCC network
```
